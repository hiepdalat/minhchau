<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Trang ch√≠nh</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Font m·ªÅm m·∫°i -->
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@500&display=swap" rel="stylesheet">

  <!-- SweetAlert -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- YouTube Iframe‚ÄØAPI (ƒë·∫∑t TR∆Ø·ªöC script t·ª± vi·∫øt) -->
  <script src="https://www.youtube.com/iframe_api"></script>

  <style>
    /* ======= N·ªÄN & B·ªê C·ª§C ======= */
    body{
      margin:0;
      font-family:'Quicksand',sans-serif;
      display:flex;
      justify-content:center;
      align-items:center;
      min-height:100vh;
      background-image:url('https://raw.githubusercontent.com/hiepdalat/minhchau/main/public/hinhnen.jpg');
      background-size:cover;
      background-position:center;
      background-repeat:no-repeat;
      background-attachment:fixed;
    }

    /* ======= H·ªòP ƒêƒÇNG NH·∫¨P ======= */
    .box{
      background:rgba(255,255,255,.85);
      backdrop-filter:blur(6px);
      padding:36px 30px;
      border-radius:20px;
      box-shadow:0 8px 24px rgba(0,0,0,.2);
      width:320px;
      text-align:center;
    }
    h2{
      color:#4a90e2;
      margin:0 0 20px;
      font-size:24px;
    }
    input{
      width:100%;
      padding:12px;
      margin:10px 0;
      border:none;
      border-radius:10px;
      background:#f9f9f9;
      box-shadow:inset 0 0 4px rgba(0,0,0,.1);
      font-size:15px;
    }

    /* ======= N√öT CH·ª®C NƒÇNG ======= */
    .btn{
      width:100%;
      padding:12px;
      margin-top:12px;
      border:none;
      border-radius:12px;
      font-size:16px;
      font-weight:bold;
      color:#fff;
      cursor:pointer;
      transition:all .3s;
    }
    .btn-congno{background:#6C63FF;}
    .btn-kho   {background:#57C478;}
    .btn-bh    {background:#FF8C42;}
    .btn:hover{opacity:.92;transform:scale(1.03);}
    hr{margin:24px 0;border:0;border-top:1px solid #ddd;}

    /* ======= TR√åNH PH√ÅT NH·∫†C ======= */
    .music-box{
      margin-top:24px;
      text-align:center;
    }
    #volumeControl{
      width:160px;
      margin-top:10px;
      appearance:none;
      height:6px;
      border-radius:4px;
      background:#ccc;
      outline:none;
      cursor:pointer;
    }
    #volumeControl::-webkit-slider-thumb{
      appearance:none;
      width:14px;height:14px;
      border-radius:50%;
      background:#4a90e2;
      border:none;
    }

    /* ======= N√öT ƒêI·ªÄU KHI·ªÇN ======= */
    .controls{
      margin-top:12px;
      display:flex;
      justify-content:center;
      gap:14px;
    }
    .controls button{
      background:#4a90e2;
      color:#fff;
      border:none;
      width:38px;height:38px;
      border-radius:50%;
      font-size:18px;
      cursor:pointer;
      transition:transform .25s, opacity .25s;
    }
    .controls button:hover{opacity:.87;transform:scale(1.1);}
    #shuffleBtn.active{background:#FF8C42;}

    /* ======= T√äN B√ÄI ƒêANG PH√ÅT ======= */
    #nowPlaying{
      margin-top:10px;
      font-size:14px;
      color:#4a90e2;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
  </style>
</head>

<body>
  <div class="box">
    <h2>üåº ƒêƒÉng nh·∫≠p h·ªá th·ªëng</h2>
    <input id="username" placeholder="üë§ T√†i kho·∫£n">
    <input id="password" type="password" placeholder="üîí M·∫≠t kh·∫©u">

    <hr>

    <button class="btn btn-congno" onclick="chucNang('/congno.html')">üìí Qu·∫£n L√Ω C√¥ng N·ª£</button>
    <button class="btn btn-kho"     onclick="chucNang('/khohang.html')">üì¶ Qu·∫£n L√Ω Kho</button>
    <button class="btn btn-bh"      onclick="chucNang('/banhang.html')">üõí Qu·∫£n L√Ω B√°n H√†ng</button>

    <!-- ======= TR√åNH PH√ÅT NH·∫†C ======= -->
    <div class="music-box">
      <!-- Player ·∫©n (0√ó0) ƒë·ªÉ l·∫•y √¢m thanh -->
      <div id="ytPlayer"></div>

      <!-- Slider volume -->
      <input type="range" id="volumeControl" min="0" max="100" value="70">

      <!-- N√∫t ƒëi·ªÅu khi·ªÉn -->
      <div class="controls">
        <button id="prevBtn"   title="B√†i tr∆∞·ªõc">‚èÆ</button>
        <button id="nextBtn"   title="B√†i k·∫ø">‚è≠</button>
        <button id="shuffleBtn" title="Shuffle">üîÄ</button>
      </div>

      <!-- T√™n b√†i ƒëang ph√°t -->
      <div id="nowPlaying">‚Ä¶</div>
    </div>
  </div>

  <!-- ====================== SCRIPT ====================== -->
  <script>
    /* ---------- LOGIN ---------- */
    let isLoggedIn = false;
    async function loginIfNeeded(){
      if(isLoggedIn) return true;
      const username=document.getElementById('username').value.trim();
      const password=document.getElementById('password').value.trim();
      if(!username||!password){
        Swal.fire('Thi·∫øu th√¥ng tin','Vui l√≤ng nh·∫≠p t√†i kho·∫£n v√† m·∫≠t kh·∫©u!','warning');
        return false;
      }
      try{
        const res=await fetch('/login',{
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body:JSON.stringify({username,password})
        });
        if(res.ok){isLoggedIn=true;return true;}
        else{
          const text=await res.text();
          Swal.fire('L·ªói ƒëƒÉng nh·∫≠p',text||'Sai t√†i kho·∫£n ho·∫∑c m·∫≠t kh·∫©u!','error');
          return false;
        }
      }catch{
        Swal.fire('L·ªói','Kh√¥ng k·∫øt n·ªëi ƒë∆∞·ª£c server.','error');
        return false;
      }
    }
    async function chucNang(path){
      const ok=await loginIfNeeded();
      if(ok) window.location.href=path;
    }
    document.getElementById('password')
      .addEventListener('keydown',e=>{if(e.key==='Enter') chucNang('/congno.html');});

    /* ---------- YOUTUBE AUDIO ---------- */
    const playlists = [
      'PLv1quoEqqgjAihdJtJZVKWtZWo_vD2y6U', // Lo‚Äëfi chill
      'PLb6SKl2NeUNmVWEYVtFR7PZ6Cvj1QKkuC', // Guitar acoustic
      'PLUybubhBTyxw3kZ9zolmZ_6BrQ2leETko', // Piano th∆∞ gi√£n
      'PLYkB2GLfxxJfKld8qa_raVXHWFB8OL2tK'  // Ambient chill
    ];
    let listIdx = 0;      // playlist hi·ªán t·∫°i
    let player;           // ƒë·ªëi t∆∞·ª£ng YT.Player
    let shuffle = false;  // tr·∫°ng th√°i shuffle

    /* YouTube Iframe API callback */
    function onYouTubeIframeAPIReady(){
      player = new YT.Player('ytPlayer',{
        height:'0', width:'0',
        playerVars:{
          listType:'playlist',
          list:playlists[listIdx],
          autoplay:1,
          loop:1     // l·∫∑p trong playlist
        },
        events:{
          onReady:onPlayerReady,
          onStateChange:onPlayerStateChange
        }
      });
    }

    function onPlayerReady(){
      player.setVolume(70);
      player.playVideo();
      updateNowPlaying();
      if(shuffle) player.setShuffle(true);
    }

    function onPlayerStateChange(e){
      // Khi h·∫øt b√†i cu·ªëi ‚Üí chuy·ªÉn playlist k·∫ø ti·∫øp
      if(e.data === YT.PlayerState.ENDED &&
         player.getPlaylistIndex() === player.getPlaylist().length - 1){
        listIdx = (listIdx + 1) % playlists.length;
        player.loadPlaylist({listType:'playlist', list:playlists[listIdx], index:0});
        if(shuffle) player.setShuffle(true);
      }
      // C·∫≠p nh·∫≠t t√™n b√†i khi ph√°t
      if(e.data === YT.PlayerState.PLAYING) updateNowPlaying();
    }

    /* Hi·ªÉn th·ªã t√™n b√†i */
    function updateNowPlaying(){
      const title = player?.getVideoData()?.title || '';
      document.getElementById('nowPlaying').textContent = title;
    }

    /* Volume */
    document.getElementById('volumeControl')
      .addEventListener('input', e=>{
        player?.setVolume(+e.target.value);
      });

    /* N√∫t Prev / Next / Shuffle */
    document.getElementById('prevBtn').onclick   = ()=> player?.previousVideo();
    document.getElementById('nextBtn').onclick   = ()=> player?.nextVideo();
    const shuffleBtn = document.getElementById('shuffleBtn');
    shuffleBtn.onclick = ()=>{
      shuffle = !shuffle;
      player?.setShuffle(shuffle);
      shuffleBtn.classList.toggle('active', shuffle);
    };
  </script>
</body>
</html>
